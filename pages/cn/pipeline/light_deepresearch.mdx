---
title: "Light DeepResearch"
icon: "lightbulb"
---

<Note>æˆ‘ä»¬ä¸ºè¯¥ Demo å½•åˆ¶äº†ä¸€æœŸè®²è§£è§†é¢‘ï¼š[ğŸ“º bilibili](https://www.bilibili.com/video/BV1p8JfziEwM/?spm_id_from=333.337.search-card.all.click)ã€‚</Note>

## ä»€ä¹ˆæ˜¯DeepResearch

Deep Researchï¼ˆä¹Ÿç§°ä¸º Agentic Deep Researchï¼‰æ˜¯æŒ‡å¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰ååŒå·¥å…·ï¼ˆå¦‚æœç´¢ã€æµè§ˆå™¨ã€ä»£ç æ‰§è¡Œã€è®°å¿†å­˜å‚¨ç­‰ï¼‰ï¼Œä»¥â€œå¤šè½®æ¨ç†â†’æ£€ç´¢â†’éªŒè¯â†’èåˆâ€çš„é—­ç¯æ–¹å¼ï¼Œå®Œæˆå¤æ‚ä»»åŠ¡çš„ç ”ç©¶å‹æ™ºèƒ½ä»£ç†ã€‚

ä¸åŒäºå•æ¬¡æ£€ç´¢çš„ RAGï¼ˆRetrieval-Augmented Generationï¼‰ï¼ŒDeep Research æ›´åƒäººçš„ä¸“å®¶æ€è·¯â€”â€”å…ˆåˆ¶å®šè®¡åˆ’ï¼Œå†ä¸æ–­æ¢ç´¢ã€è°ƒæ•´æ–¹å‘ã€æ ¸å®ä¿¡æ¯ï¼Œæœ€ç»ˆè¾“å‡ºç»“æ„å®Œæ•´ã€æœ‰å‡ºå¤„çš„æŠ¥å‘Šã€‚

## å‰ç½®å‡†å¤‡ 

åœ¨æœ¬æ¬¡å¼€å‘ä¸­ï¼Œæˆ‘ä»¬å°†åŸºäº UltraRAG æ¡†æ¶ å®Œæˆç¤ºä¾‹ã€‚è€ƒè™‘åˆ°å¤§å¤šæ•°å°ä¼™ä¼´å¯èƒ½æ²¡æœ‰ç®—åŠ›æœåŠ¡å™¨ï¼Œæˆ‘ä»¬å…¨ç¨‹åœ¨ä¸€å° MacBook Air (M2) ä¸Šå®ç°ï¼Œç¡®ä¿ç¯å¢ƒè½»é‡ã€æ˜“äºå¤ç°ã€‚

### APIå‡†å¤‡

- æ£€ç´¢ APIï¼šæˆ‘ä»¬é‡‡ç”¨ [Tavily Web Search](https://www.tavily.com/)ï¼Œåˆæ¬¡æ³¨å†Œå³å¯å…è´¹è·å¾— 1000 æ¬¡è°ƒç”¨é¢åº¦ã€‚
- LLM APIï¼šä½ å¯ä»¥æ ¹æ®è‡ªå·±çš„ä¹ æƒ¯é€‰æ‹©ä»»æ„å¤§æ¨¡å‹æœåŠ¡ã€‚æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ gpt-5-nano ä½œä¸ºç¤ºä¾‹

### APIè®¾ç½®

æˆ‘ä»¬æä¾›äº†ä¸¤ç§æ–¹å¼ä¼ å…¥ API Keyï¼šç¯å¢ƒå˜é‡å’Œæ˜¾å¼å‚æ•°ã€‚å…¶ä¸­æ¨èä½¿ç”¨ ç¯å¢ƒå˜é‡ï¼Œæ›´å®‰å…¨ï¼Œä¹Ÿèƒ½é¿å… API Key åœ¨æ—¥å¿—ä¸­æ³„æ¼ã€‚

åœ¨ UR-2.0 æ ¹ç›®å½•ä¸‹ï¼Œå°†æ¨¡æ¿æ–‡ä»¶ `.env.dev` é‡å‘½åä¸º `.env`ï¼Œ
å¹¶å¡«å†™ä½ çš„å¯†é’¥ä¿¡æ¯ï¼Œä¾‹å¦‚ï¼š

```
LLM_API_KEY="your llm key"
TAVILY_API_KEY="your retriever key"
```
UR-2.0 ä¼šåœ¨å¯åŠ¨æ—¶è‡ªåŠ¨è¯»å–è¯¥æ–‡ä»¶å¹¶åŠ è½½ç›¸å…³é…ç½®ã€‚

## Pipelineä»‹ç»

åœ¨æœ¬ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å°†å®ç°ä¸€ä¸ªè½»é‡çº§çš„ Deep Research Pipelineã€‚å®ƒå…·å¤‡ä»¥ä¸‹åŸºæœ¬åŠŸèƒ½ï¼š

- Plan åˆ¶å®šï¼šæ¨¡å‹å…ˆæ ¹æ®ç”¨æˆ·é—®é¢˜åˆ¶å®šè§£å†³æ–¹æ¡ˆçš„è®¡åˆ’ï¼›
- å­é—®é¢˜ç”Ÿæˆä¸æ£€ç´¢ï¼šå°†å¤§é—®é¢˜åˆ†è§£ä¸ºå¯æ£€ç´¢çš„å­é—®é¢˜ï¼Œå¹¶è°ƒç”¨ Web æœç´¢å·¥å…·è·å–ç›¸å…³èµ„æ–™ï¼›
- æŠ¥å‘Šæ•´ç†ä¸å¡«å……ï¼šé€æ­¥å®Œå–„ç ”ç©¶æŠ¥å‘Šçš„å†…å®¹ï¼›
- æ¨ç†ä¸æœ€ç»ˆç”Ÿæˆï¼šåœ¨æŠ¥å‘Šå®Œæˆåï¼Œæ¨¡å‹ç»™å‡ºæœ€ç»ˆç­”æ¡ˆã€‚

æµç¨‹å›¾å¦‚ä¸‹æ‰€ç¤ºï¼š

![](/images/pipeline/light_deep/pipe.png)

è¯¥ pipeline ä¸»è¦åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼š

1. **åˆå§‹åŒ–é˜¶æ®µ:** æ¨¡å‹ä¼šæ ¹æ®ç”¨æˆ·é—®é¢˜ç”Ÿæˆä¸€ä»½ planï¼Œå¹¶æ®æ­¤æ„é€ å‡ºåˆå§‹çš„æŠ¥å‘Š pageã€‚

2. **è¿­ä»£å¡«å……é˜¶æ®µ:**
   
- ç³»ç»Ÿä¼šæ£€æŸ¥å½“å‰æŠ¥å‘Š page æ˜¯å¦å·²å¡«å……å®Œæ•´ã€‚
- åˆ¤æ–­æ ‡å‡†ä¸ºï¼špage ä¸­æ˜¯å¦ä»å­˜åœ¨ "to be filled" å­—ç¬¦ä¸²ã€‚
- å¦‚æœæŠ¥å‘Šå°šæœªå®Œæˆï¼Œæ¨¡å‹ä¼šç»“åˆç”¨æˆ·é—®é¢˜ã€plan ä¸å½“å‰ pageï¼Œç”Ÿæˆä¸€ä¸ªæ–°çš„å­é—®é¢˜å¹¶è§¦å‘ Web æ£€ç´¢ã€‚
- æ£€ç´¢åˆ°çš„æ–‡æ¡£ä¼šè¢«ç”¨äºæ›´æ–° pageï¼Œç„¶åè¿›å…¥ä¸‹ä¸€è½®æ£€æŸ¥ã€‚
- è¿™ä¸ªè¿‡ç¨‹ä¼šæŒç»­è¿­ä»£ï¼Œç›´åˆ° page è¢«å¡«æ»¡ã€‚
  
æœ€åï¼Œæ¨¡å‹ä¼šåŸºäºç”¨æˆ·é—®é¢˜ä¸æœ€ç»ˆæŠ¥å‘Š pageï¼Œç”Ÿæˆå®Œæ•´çš„ç­”æ¡ˆã€‚

è¿™ä¸ªç¤ºä¾‹çš„ä»£ç å®ç°éå¸¸ç®€æ´ï¼Œä¸»è¦ä¾èµ– router ä¸ prompt tool çš„è‡ªå®šä¹‰æ‰©å±•ã€‚æ„Ÿå…´è¶£çš„å°ä¼™ä¼´å¯ä»¥ç›´æ¥æŸ¥çœ‹æºç ã€‚ä»¥ä¸‹æ˜¯å®Œæ•´çš„ pipeline å®šä¹‰ï¼š

```yaml examples/light_deepresearch.yaml icon="/images/yaml.svg"
# MCP Server
servers:
  benchmark: servers/benchmark
  generation: servers/generation
  retriever: servers/retriever
  prompt: servers/prompt
  router: servers/router

# MCP Client Pipeline
pipeline:
- benchmark.get_data
- generation.generation_init
- prompt.webnote_gen_plan
- generation.generate:
    output:
      ans_ls: plan_ls
- prompt.webnote_init_page
- generation.generate:
    output:
      ans_ls: page_ls
- loop:
    times: 10
    steps:
    - branch:
        router:
        - router.webnote_check_page
        branches:
          incomplete:
          - prompt.webnote_gen_subq
          - generation.generate:
              output:
                ans_ls: subq_ls
          - retriever.retriever_tavily_search:
              input:
                query_list: subq_ls
              output:
                ret_psg: psg_ls
          - prompt.webnote_fill_page
          - generation.generate:
              output:
                ans_ls: page_ls
          complete: []
- prompt.webnote_gen_answer
- generation.generate
```

## è¿è¡Œ

### æ„å»ºé—®é¢˜æ•°æ®

é¦–å…ˆï¼Œåœ¨ data æ–‡ä»¶å¤¹ä¸‹æ–°å»ºä¸€ä¸ªåä¸º sample_light_ds.jsonl çš„æ–‡ä»¶ï¼Œå¹¶å†™å…¥ä½ è¦ç ”ç©¶çš„é—®é¢˜ã€‚ä¾‹å¦‚ï¼š

```json data/sample_light_ds.jsonl icon="/images/json.svg"
{"id": 0, "question": "ä»‹ç»ä¸€ä¸‹æç“¦ç‰¹å¤§é™†", "golden_answers": [], "meta_data": {}}
```

### æ„å»ºå‚æ•°é…ç½®æ–‡ä»¶

æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ç”Ÿæˆ pipeline å¯¹åº”çš„å‚æ•°æ–‡ä»¶ï¼š

```shell
ultrarag build examples/light_deepresearch.yaml
```

æ ¹æ®å®é™…æƒ…å†µå¯¹å‚æ•°è¿›è¡Œä¿®æ”¹ï¼Œä¾‹å¦‚ï¼š

```yaml
benchmark:
  benchmark:
    key_map:
      gt_ls: golden_answers
      q_ls: question
    limit: -1
    name: nq # [!code --]
    path: data/sample_nq_10.jsonl # [!code --]
    name: ds # [!code ++]
    path: data/sample_light_ds.jsonl # [!code ++]
    seed: 42
    shuffle: false
generation:
  backend: vllm # [!code --]
  backend: openai # [!code ++]
  backend_configs:
    hf:
      batch_size: 8
      gpu_ids: 2,3
      model_name_or_path: openbmb/MiniCPM4-8B
      trust_remote_code: true
    openai:
      api_key: ''
      base_delay: 1.0
      base_url: http://localhost:8000/v1 # [!code --]
      base_url: https://api.openai.com/v1 # [!code ++]
      concurrency: 8
      model_name: MiniCPM4-8B # [!code --]
      model_name: gpt-5-nano # [!code ++]
      retries: 3
    vllm:
      dtype: auto
      gpu_ids: 2,3
      gpu_memory_utilization: 0.9
      model_name_or_path: openbmb/MiniCPM4-8B
      trust_remote_code: true
  sampling_params:
    chat_template_kwargs:
      enable_thinking: false
    max_tokens: 2048
    temperature: 0.7
    top_p: 0.8 # [!code --]
  system_prompt: ''
prompt:
  webnote_fill_page_template: prompt/webnote_fill_page.jinja
  webnote_gen_answer_template: prompt/webnote_gen_answer.jinja
  webnote_gen_plan_template: prompt/webnote_gen_plan.jinja
  webnote_gen_subq_template: prompt/webnote_gen_subq.jinja
  webnote_init_page_template: prompt/webnote_init_page.jinja
retriever:
  retrieve_thread_num: 1
  top_k: 5
```


### å¯åŠ¨

åœ¨è¿è¡Œå‰ï¼Œä¸è¦å¿˜è®°è®¾ç½®ä½ çš„ API Keyï¼š
```shell
ultrarag run examples/light_deepresearch.yaml
```

è¿è¡Œå®Œæˆåï¼Œä½ å¯ä»¥é€šè¿‡ Case Study Viewer å¯è§†åŒ–åœ°æŸ¥çœ‹ç”Ÿæˆå†…å®¹ï¼š

```shell
python ./script/case_study.py \
  --data output/memory_ds_light_deepresearch_20250909_152727.json   \
  --host 127.0.0.1 \
  --port 8070 \
  --title "Case Study Viewer"
```

è¿™æ ·å³å¯åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ç»“æœé¡µé¢ï¼Œç›´è§‚åœ°åˆ†æ pipeline çš„æ‰§è¡Œè¿‡ç¨‹ä¸ç”Ÿæˆå†…å®¹ã€‚

![](/images/pipeline/light_deep/result.png)